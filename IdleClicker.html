<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Neon Glass Clicker</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js">
    </script>
    <style>
        :root {
            --primary: #7c3aed;
            --secondary: #ff6b6b;
            --glass: rgba(255, 255, 255, 0.1);
            --text: rgba(255, 255, 255, 0.9);
            --container-bg: linear-gradient(45deg, #1a1a2e, #16213e);
            --primary-rgb: 124, 58, 237;
            --secondary-rgb: 255, 107, 107;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Let the body fill the screen, center the main container */
        body {
            background: var(--container-bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            position: relative;
            /* so we can place the popup absolutely inside */
            background: var(--glass);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 2rem;
            width: 95%;
            max-width: 1200px;
        }

        /* HEADER */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .title-container {
            text-align: center;
            margin-bottom: 1rem;
        }

        .title {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 8px rgba(124, 58, 237, 0.5));
            margin: 0;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text);
            opacity: 0.8;
            margin-top: 0.5rem;
            text-align: left;
        }

        .subtitle span {
            font-weight: 700;
            color: var(--secondary);
            text-shadow: 0 2px 4px rgba(255, 107, 107, 0.5);
        }

        .right-header {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            position: relative;
            z-index: 10;
        }

        .control-button {
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* REBIRTH COUNTER */
        .rebirth-counter {
            background: var(--glass);
            padding: 0.6rem 1rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            font-weight: 500;
            transition: background 0.3s;
        }

        .rebirth-counter:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* RESOURCES */
        .resource-display {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin-bottom: 2rem;
            font-size: 1.5rem;
            background: var(--glass);
            padding: 1rem 2rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
        }

        .rebirth-bonuses {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 2rem;
            /* Increased padding for better spacing */
            text-align: center;
            margin-top: 2rem;
            /* Adds space between this section and the content above */
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .rebirth-bonuses h3 {
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            /* Extra space below the title */
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .bonus-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 1rem 0;
            /* Adds vertical space between items */
            color: white;
        }

        .bonus-item i {
            color: var(--primary);
            font-size: 1.4rem;
        }

        #rebirth-confirm-button {
            margin-top: 2rem;
            /* Adds space between the bonus section and the button */
        }

        /* CLICK BUTTON */
        .click-section {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .click-button {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: linear-gradient(45deg,
                    var(--primary) 0%,
                    var(--secondary) 100%);
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow:
                0 0 40px 8px rgba(var(--primary-rgb), 0.3),
                0 0 60px 15px rgba(var(--secondary-rgb), 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }

        /* Floating Animation */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-10px) rotate(2deg);
            }
        }

        .click-button::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg,
                    transparent 20%,
                    rgba(255, 255, 255, 0.15) 50%,
                    transparent 80%);
            opacity: 0.6;
            animation: shine 4s infinite;
        }

        /* Hover Effects */
        .click-button:hover {
            transform:
                scale(1.08) rotateZ(2deg) translateZ(20px);
            box-shadow:
                0 0 60px 12px rgba(var(--primary-rgb), 0.5),
                0 0 80px 20px rgba(var(--secondary-rgb), 0.3);
        }

        /* Active/Press Animation */
        .click-button:active {
            transform: scale(0.95);
            filter: brightness(1.2);
        }

        /* Ripple Effect */
        .click-button::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center,
                    rgba(255, 255, 255, 0.4) 0%,
                    transparent 70%);
            opacity: 0;
            animation: ripple 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        @keyframes ripple {
            0% {
                transform: scale(0.8);
                opacity: 0.6;
            }

            100% {
                transform: scale(1.6);
                opacity: 0;
            }
        }

        /* Icon Styling */
        .click-button i {
            font-size: 4rem;
            pointer-events: none;
            background: linear-gradient(45deg,
                    rgba(255, 255, 255, 1) 30%,
                    rgba(255, 255, 255, 0.7));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 12px rgba(124, 58, 237, 0.4));
            transition: transform 0.3s ease;
        }

        /* Particle Burst Animation */
        @keyframes particle-burst {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        /* Add these keyframes */
        @keyframes shine {
            0% {
                transform: translateX(-100%) skew(-15deg);
            }

            100% {
                transform: translateX(200%) skew(-15deg);
            }
        }

        /* Continuous Pulse */
        @keyframes pulse-glow {

            0%,
            100% {
                filter: brightness(1);
            }

            50% {
                filter: brightness(1.2);
            }
        }

        .click-button {
            animation: float 6s ease-in-out infinite, pulse-glow 3s ease-in-out infinite;
        }

        /* EXPERIENCE / LEVEL BAR */
        /* EXPERIENCE / LEVEL BAR */
        .level-display {
            margin: 2rem 0;
            text-align: center;
            transform: translateZ(0);
        }

        .progress-container {
            width: 90%;
            margin: 0 auto;
            height: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .progress-bar {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg,
                    var(--primary) 0%,
                    var(--secondary) 50%,
                    var(--primary) 100%);
            background-size: 200% 100%;
            border-radius: 18px;
            transform-origin: left center;
            will-change: transform;
            position: relative;
            overflow: hidden;
            animation: gradientFlow 4s linear infinite;
            transition: width 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }


        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0) 100%);
            animation: shine 3s ease-in-out infinite;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 2px 8px rgba(124, 58, 237, 0.8);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            pointer-events: none;
        }

        .progress-text::before {
            content: '⬥';
            color: var(--secondary);
            filter: drop-shadow(0 0 8px var(--secondary));
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes gradientFlow {
            0% {
                background-position-x: 200%;
            }

            100% {
                background-position-x: -200%;
            }
        }

        .smooth-transition {
            transition: transform 0.3s cubic-bezier(0.22, 0.61, 0.36, 1);
        }

        @keyframes shine {
            0% {
                left: -100%;
            }

            100% {
                left: 200%;
            }
        }

        @keyframes pulse {
            0% {
                opacity: 0.8;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }

            100% {
                opacity: 0.8;
                transform: scale(1);
            }
        }

        /* Level Up Animation */
        @keyframes levelUp {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            20% {
                transform: scale(1.15);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .level-up {
            animation: levelUp 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
            position: relative;
        }

        /* Add glow effect using pseudo-element */
        .level-up::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 20px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            filter: blur(10px);
            opacity: 0;
            animation: glowPulse 0.6s ease-out;
            z-index: -1;
        }

        @keyframes glowPulse {
            0% {
                opacity: 0;
            }

            50% {
                opacity: 0.8;
            }

            100% {
                opacity: 0;
            }
        }

        .level-up {
            animation: levelUp 0.8s ease-out;
        }

        /* UPGRADES */
        .upgrades-section {
            margin-top: 3rem;
            position: relative;
        }

        .upgrades-title {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            font-weight: 700;
            text-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
        }

        .upgrades {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            padding: 1rem;
        }

        .upgrade-card {
            background: linear-gradient(145deg,
                    rgba(255, 255, 255, 0.05) 0%,
                    rgba(255, 255, 255, 0.01) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1.5rem;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            backdrop-filter: blur(12px);
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transform: translateZ(0);
        }

        .upgrade-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg,
                    rgba(var(--primary-rgb), 0.15) 0%,
                    rgba(var(--secondary-rgb), 0.05) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
        }

        .upgrade-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
        }

        .upgrade-card:hover::before {
            opacity: 1;
        }

        .upgrade-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 8px rgba(var(--primary-rgb), 0.3));
        }

        .upgrade-name-level {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .upgrade-name-level h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
            flex: 1;
            color: rgba(255, 255, 255, 0.95);
        }

        .upgrade-level-badge {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: #fff;
            border-radius: 8px;
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 0.5rem;
            box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.2);
        }

        .upgrade-cost {
            margin-bottom: 1rem;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .upgrade-cost i {
            color: var(--secondary);
        }

        .upgrade-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .upgrade-info-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upgrade-info-button:hover {
            background: rgba(var(--primary-rgb), 0.2);
            transform: rotate(12deg) scale(1.1);
        }

        .upgrade-buy-button {
            flex: 1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 0.8rem 1.5rem;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(var(--primary-rgb), 0.3);
        }

        .upgrade-buy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(var(--primary-rgb), 0.4);
        }

        /* Upgrade Details Modal */
        .upgrade-details-modal .modal-content {
            max-width: 500px;
            text-align: left;
        }

        .upgrade-details-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .upgrade-details-icon {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .upgrade-stats {
            display: grid;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            gap: 2rem
        }

        .stat-label::after {
            content: ":";
            margin-right: 0.5rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .stat-value {
            color: var(--secondary);
            font-weight: 600;
        }

        /* MODALS: full-page overlay for settings, achievements, rebirth */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 99vw;
            height: 120vh;
            display: flex;
            /* hidden by default */
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .modal-content {
            background: var(--glass);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: modalEnter 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 80vh;
            overflow-y: auto;
            scrollbar-width: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 0rem;
            position: relative;
            /* Add spacing between sections */
        }

        /* Hide scrollbar for WebKit browsers (Chrome, Safari) */
        .modal-content::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        @keyframes modalEnter {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .settings-content {
            gap: 1.5rem;
            width: 100%;
            padding: 2rem;
        }

        .settings-grid {
            display: grid;
            gap: 1.2rem;
            width: 100%;
        }

        .settings-button {
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.18);
            padding: 1.5rem;
            border-radius: 16px;
            font-size: 1.1rem;
            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 280px;
        }

        .settings-button::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg,
                    rgba(var(--primary-rgb), 0.15) 0%,
                    rgba(var(--secondary-rgb), 0.08) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .settings-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .settings-button:hover::before {
            opacity: 1;
        }

        .settings-button i {
            font-size: 1.6rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: all 0.3s ease;
        }

        .settings-button:hover i {
            transform: scale(1.15) rotate(12deg);
            filter: drop-shadow(0 2px 4px rgba(var(--primary-rgb), 0.3));
        }

        .settings-button span {
            background: linear-gradient(45deg, #fff 30%, rgba(255, 255, 255, 0.9));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        /* Modal Header */
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding-bottom: 1.5rem;
        }

        .settings-title {
            font-size: 2rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .settings-close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text);
            padding: 0.8rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-close-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: rotate(90deg);
        }

        /* Animations */
        @keyframes buttonFloat {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-4px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .settings-button {
            animation: buttonFloat 6s ease-in-out infinite;
        }

        @keyframes modalEntry {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-content {
            animation: modalEntry 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* ACHIEVEMENTS POPUP: Now absolute, placed inside .game-container */
        .achievement-popup {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: var(--glass);
            backdrop-filter: blur(8px);
            padding: 1rem 2rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 2000;
            pointer-events: none;
        }

        .achievement-popup.show {
            opacity: 1;
            transform: translateX(0);
        }

        .popup-title {
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        /* Achievements List in the Achievements Modal */
        .achievements-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .achievement-card {
            display: flex;
            flex-direction: column;
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            border-radius: 16px;
            padding: 1rem;
            transition: transform 0.3s;
            position: relative;
        }

        .achievement-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .achievement-top-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .achievement-icon {
            font-size: 2rem;
            margin-right: 1rem;
            color: var(--secondary);
        }

        .achievement-content {
            flex: 1;
        }

        .achievement-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .achievement-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .achievement-status {
            font-size: 1.4rem;
            margin-left: auto;
            margin-right: 0.2rem;
        }

        .achievement-progress-container {
            margin-top: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .achievement-progress-fill {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            width: 0%;
            transition: width 0.4s;
        }

        .achievement-progress-text {
            text-align: right;
            font-size: 0.7rem;
            margin-top: 4px;
            opacity: 0.7;
        }

        .achievement-card.locked .achievement-icon {
            filter: grayscale(100%);
            opacity: 0.4;
        }

        .achievement-card.locked .achievement-status {
            color: rgba(255, 255, 255, 0.5);
        }

        .achievement-card.completed {
            border-color: rgba(255, 255, 255, 0.3);
        }

        .achievement-card.completed .achievement-status {
            color: limegreen;
        }

        /* REBIRTH MODAL */
        .rebirth-info {
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem 0;
            text-align: center;
        }

        .rebirth-info span {
            font-weight: 600;
            color: var(--secondary);
        }

        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Notification Style */
        .notification {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            color: var(--text);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.4s ease, fadeOut 0.4s ease 3.6s;
            opacity: 0;
            pointer-events: none;
            transform: translateY(-10px);
        }

        /* Icon Style */
        .notification i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        /* Notification Text */
        .notification-text {
            flex: 1;
            font-size: 1rem;
            line-height: 1.5;
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div class="game-container">
        <!-- HEADER -->
        <div class="header">
            <div class="title-container">
                <h1 class="title">Neon Clicker</h1>
                <p class="subtitle">Developed by <span>Nytro101</span></p>
            </div>
            <div class="right-header">
                <div id="rebirth-counter" class="rebirth-counter">Rebirths: 0</div>
                <div class="controls">
                    <div class="control-button" id="rebirth-button">
                        <i class="fas fa-redo-alt"></i>
                    </div>
                    <div class="control-button" id="achievements-button">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="control-button" id="settings-button">
                        <i class="fas fa-cog"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- LEVEL/EXP BAR -->
        <div class="level-display">
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
                <div class="progress-text" id="progress-text">Level 1 - 0%</div>
            </div>
        </div>

        <!-- RESOURCES -->
        <div class="resource-display">
            <div>
                <i class="fas fa-coins"></i> <span id="coin-count">0</span>
            </div>
            <div>
                <i class="fas fa-star"></i> <span id="exp-count">0</span>
            </div>
        </div>

        <!-- CLICK BUTTON -->
        <div class="click-section">
            <button class="click-button" id="click-button">
                <i class="fas fa-hand-pointer"></i>
            </button>
        </div>

        <!-- UPGRADES SECTION -->
        <div class="upgrades-section">
            <h2 class="upgrades-title">Upgrades</h2>
            <div class="upgrades" id="upgrades-container"></div>
        </div>

        <!-- SETTINGS MODAL -->
        <div id="settings-modal" class="modal" style="display: none;">
            <div class="modal-content settings-content">
                <div class="settings-header">
                    <h2 class="settings-title">Game Settings</h2>
                </div>

                <div class="settings-grid">
                    <button id="save-game-button" class="settings-button">
                        <i class="fas fa-save"></i>
                        <span>Save Progress</span>
                    </button>

                    <button id="reset-game-button" class="settings-button">
                        <i class="fas fa-trash-restore"></i>
                        <span>Reset Game</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ACHIEVEMENTS MODAL -->
        <div id="achievements-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Achievements</h2>
                <div id="achievements-list" class="achievements-list"></div>
            </div>
        </div>

        <!-- REBIRTH MODAL -->
        <div id="rebirth-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>Rebirth</h2>
                <div class="rebirth-info" id="rebirth-info"></div>

                <!-- New Section to Show Current Bonuses -->
                <div class="rebirth-bonuses">
                    <h3>Current Bonuses</h3>
                    <p><strong>Click Multiplier:</strong> <span id="rebirth-click-multiplier">x1</span></p>
                    <p><strong>Income Multiplier:</strong> <span id="rebirth-income-multiplier">x1</span></p>
                </div>

                <button id="rebirth-confirm-button" class="upgrade-buy-button">
                    <i class="fas fa-redo-alt"></i> Rebirth
                </button>
            </div>
        </div>

        <!-- ACHIEVEMENT POPUP (Inside .game-container now) -->
        <div id="achievement-popup" class="achievement-popup">
            <div class="popup-title">Achievement Unlocked!</div>
            <div class="popup-description"></div>
        </div>
    </div>

    <div class="notification-container" id="notification-container"></div>

    <script>

        document.getElementById('click-button').addEventListener('click', function () {
            // Create particle burst effect
            const particles = 8;
            for (let i = 0; i < particles; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
            position: absolute;
            width: 12px;
            height: 12px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%;
            pointer-events: none;
            animation: particle-burst 0.8s ease-out;
            --tx: ${Math.random() * 100 - 50}px;
            --ty: ${Math.random() * 100 - 50}px;
        `;
                this.appendChild(particle);
                setTimeout(() => particle.remove(), 800);
            }

            // Add temporary scale effect
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 100);
        });
        // Game State
        let gameState = {
            coins: 0,
            exp: 0,
            level: 1,
            rebirths: 0,
            upgrades: {},
            upgradeCosts: {},
            achievements: {}
        };

        // Upgrades Config
        // We have a chain: time-machine => once time-machine >= 10, hide time-machine, show mega-click
        // In mega-click, we define prerequisite: { id: 'time-machine', level: 10 }
        // In time-machine, once we pass level 10, we don't show it (like it "disappears").
        const upgradesConfig = [
            // Tier 1-10: Basic to Advanced Industrial
            { id: 'auto-click', name: 'Auto Click', baseCost: 50, income: 1, evolutionLevel: 10, evolutionTarget: 'mechanical-arms' },
            { id: 'click-mult', name: 'Click Multiplier', baseCost: 100, multiplier: 1.5, evolutionLevel: 10, evolutionTarget: 'power-gloves' },
            { id: 'worker-bots', name: 'Worker Bots', baseCost: 300, income: 2, evolutionLevel: 10, evolutionTarget: 'assembly-bots' },

            // Tier 2-11: Mechanical Systems
            { id: 'mechanical-arms', name: 'Mechanical Arms', baseCost: 500, income: 3, evolutionLevel: 25, prerequisite: { id: 'auto-click', level: 10 }, evolutionTarget: 'hydraulic-press' },
            { id: 'power-gloves', name: 'Power Gloves', baseCost: 750, multiplier: 2, evolutionLevel: 25, prerequisite: { id: 'click-mult', level: 10 }, evolutionTarget: 'kinetic-amplifier' },
            { id: 'assembly-bots', name: 'Assembly Bots', baseCost: 1200, income: 5, evolutionLevel: 25, prerequisite: { id: 'worker-bots', level: 10 }, evolutionTarget: 'nanobot-swarm' },

            // Tier 3-12: Advanced Manufacturing
            { id: 'hydraulic-press', name: 'Hydraulic Press', baseCost: 2500, income: 10, evolutionLevel: 50, prerequisite: { id: 'mechanical-arms', level: 25 }, evolutionTarget: 'plasma-forge' },
            { id: 'kinetic-amplifier', name: 'Kinetic Amplifier', baseCost: 5000, multiplier: 3, evolutionLevel: 50, prerequisite: { id: 'power-gloves', level: 25 }, evolutionTarget: 'quantum-tunneler' },
            { id: 'nanobot-swarm', name: 'Nanobot Swarm', baseCost: 7500, income: 15, evolutionLevel: 50, prerequisite: { id: 'assembly-bots', level: 25 }, evolutionTarget: 'molecular-assembler' },

            // Tier 4-13: Quantum Technologies
            { id: 'plasma-forge', name: 'Plasma Forge', baseCost: 15000, income: 25, evolutionLevel: 75, prerequisite: { id: 'hydraulic-press', level: 50 }, evolutionTarget: 'fusion-core' },
            { id: 'quantum-tunneler', name: 'Quantum Tunneler', baseCost: 30000, multiplier: 5, evolutionLevel: 75, prerequisite: { id: 'kinetic-amplifier', level: 50 }, evolutionTarget: 'chrono-disruptor' },
            { id: 'molecular-assembler', name: 'Molecular Assembler', baseCost: 45000, income: 40, evolutionLevel: 75, prerequisite: { id: 'nanobot-swarm', level: 50 }, evolutionTarget: 'quantum-nanobots' },

            // Tier 5-14: Energy Systems
            { id: 'fusion-core', name: 'Fusion Core', baseCost: 100000, income: 75, evolutionLevel: 100, prerequisite: { id: 'plasma-forge', level: 75 }, evolutionTarget: 'antimatter-reactor' },
            { id: 'chrono-disruptor', name: 'Chrono Disruptor', baseCost: 200000, multiplier: 8, evolutionLevel: 100, prerequisite: { id: 'quantum-tunneler', level: 75 }, evolutionTarget: 'temporal-manipulator' },
            { id: 'quantum-nanobots', name: 'Quantum Nanobots', baseCost: 300000, income: 100, evolutionLevel: 100, prerequisite: { id: 'molecular-assembler', level: 75 }, evolutionTarget: 'grey-goo' },

            // Tier 6-15: Cosmic Infrastructure
            { id: 'antimatter-reactor', name: 'Antimatter Reactor', baseCost: 500000, income: 200, evolutionLevel: 150, prerequisite: { id: 'fusion-core', level: 100 }, evolutionTarget: 'dark-matter-extractor' },
            { id: 'temporal-manipulator', name: 'Temporal Manipulator', baseCost: 750000, multiplier: 12, evolutionLevel: 150, prerequisite: { id: 'chrono-disruptor', level: 100 }, evolutionTarget: 'time-dilation-field' },
            { id: 'grey-goo', name: 'Grey Goo', baseCost: 1000000, income: 300, evolutionLevel: 150, prerequisite: { id: 'quantum-nanobots', level: 100 }, evolutionTarget: 'programmable-matter' },

            // Tier 7-16: Galactic Engineering
            { id: 'dark-matter-extractor', name: 'Dark Matter Extractor', baseCost: 2500000, income: 500, evolutionLevel: 200, prerequisite: { id: 'antimatter-reactor', level: 150 }, evolutionTarget: 'neutron-star-forge' },
            { id: 'time-dilation-field', name: 'Time Dilation Field', baseCost: 5000000, multiplier: 18, evolutionLevel: 200, prerequisite: { id: 'temporal-manipulator', level: 150 }, evolutionTarget: 'causal-loop' },
            { id: 'programmable-matter', name: 'Programmable Matter', baseCost: 7500000, income: 750, evolutionLevel: 200, prerequisite: { id: 'grey-goo', level: 150 }, evolutionTarget: 'exotic-matter' },

            // Tier 8-17: Stellar Manipulation
            { id: 'neutron-star-forge', name: 'Neutron Star Forge', baseCost: 15000000, income: 1000, evolutionLevel: 250, prerequisite: { id: 'dark-matter-extractor', level: 200 }, evolutionTarget: 'black-hole-foundry' },
            { id: 'causal-loop', name: 'Causal Loop', baseCost: 30000000, multiplier: 25, evolutionLevel: 250, prerequisite: { id: 'time-dilation-field', level: 200 }, evolutionTarget: 'paradox-engine' },
            { id: 'exotic-matter', name: 'Exotic Matter', baseCost: 45000000, income: 1500, evolutionLevel: 250, prerequisite: { id: 'programmable-matter', level: 200 }, evolutionTarget: 'negative-mass' },

            // Tier 9-18: Black Hole Technologies
            { id: 'black-hole-foundry', name: 'Black Hole Foundry', baseCost: 100000000, income: 2500, evolutionLevel: 300, prerequisite: { id: 'neutron-star-forge', level: 250 }, evolutionTarget: 'singularity-generator' },
            { id: 'paradox-engine', name: 'Paradox Engine', baseCost: 200000000, multiplier: 35, evolutionLevel: 300, prerequisite: { id: 'causal-loop', level: 250 }, evolutionTarget: 'multiverse-bridge' },
            { id: 'negative-mass', name: 'Negative Mass', baseCost: 300000000, income: 3500, evolutionLevel: 300, prerequisite: { id: 'exotic-matter', level: 250 }, evolutionTarget: 'wormhole-stabilizer' },

            // Tier 10-19: Multiversal Systems
            { id: 'singularity-generator', name: 'Singularity Generator', baseCost: 500000000, income: 5000, evolutionLevel: 400, prerequisite: { id: 'black-hole-foundry', level: 300 }, evolutionTarget: 'cosmic-string' },
            { id: 'multiverse-bridge', name: 'Multiverse Bridge', baseCost: 750000000, multiplier: 50, evolutionLevel: 400, prerequisite: { id: 'paradox-engine', level: 300 }, evolutionTarget: 'dimensional-anchor' },
            { id: 'wormhole-stabilizer', name: 'Wormhole Stabilizer', baseCost: 1000000000, income: 7500, evolutionLevel: 400, prerequisite: { id: 'negative-mass', level: 300 }, evolutionTarget: 'hyperspace-conduit' },

            // Tier 11-20: Cosmic Entities
            { id: 'cosmic-string', name: 'Cosmic String', baseCost: 2500000000, income: 10000, evolutionLevel: 500, prerequisite: { id: 'singularity-generator', level: 400 }, evolutionTarget: 'void-reactor' },
            { id: 'dimensional-anchor', name: 'Dimensional Anchor', baseCost: 5000000000, multiplier: 75, evolutionLevel: 500, prerequisite: { id: 'multiverse-bridge', level: 400 }, evolutionTarget: 'reality-loom' },
            { id: 'hyperspace-conduit', name: 'Hyperspace Conduit', baseCost: 7500000000, income: 15000, evolutionLevel: 500, prerequisite: { id: 'wormhole-stabilizer', level: 400 }, evolutionTarget: 'quantum-foam' },

            // ... (Continuing this pattern up to 150+ upgrades)

            // Final Tier: Omniversal Control
            { id: 'omniversal-engine', name: 'Omniversal Engine', baseCost: 1e30, multiplier: 1e6, evolutionLevel: 1000, prerequisite: { id: 'metaversal-foundry', level: 900 }, evolutionTarget: 'alpha-point' },
            { id: 'alpha-point', name: 'Alpha Point', baseCost: 1e35, income: 1e12, evolutionLevel: 1500, prerequisite: { id: 'omniversal-engine', level: 1000 }, evolutionTarget: 'omega-point' },
            { id: 'omega-point', name: 'Omega Point', baseCost: 1e40, multiplier: 1e9, evolutionLevel: 2000, prerequisite: { id: 'alpha-point', level: 1500 } }
        ];

        // Achievements Config ...
        const achievementsConfig = [
            {
                id: 'first-click',
                name: 'First Click',
                description: 'Click 1 time to get started on your clicking journey.',
                icon: 'fa-mouse-pointer',
                condition: (state) => state.coins >= 1,
                progressKey: 'coins',
                goal: 10
            },
            {
                id: 'coin-collector',
                name: 'Coin Collector',
                description: 'Collect 10,000 coins overall. You’re well on your way!',
                icon: 'fa-sack-dollar',
                condition: (state) => state.coins >= 10000,
                progressKey: 'coins',
                goal: 10000
            },
            {
                id: 'millionaire',
                name: 'Millionaire',
                description: 'Accumulate 1,000,000 coins and join the millionaires club.',
                icon: 'fa-money-bill-wave',
                condition: (state) => state.coins >= 1e6,
                progressKey: 'coins',
                goal: 1e6
            },
            {
                id: 'clumsy-clicker',
                name: 'Clumsy Clicker',
                description: 'Reach 100 coins. Baby steps for the new clicker.',
                icon: 'fa-hand-pointer',
                condition: (state) => state.coins >= 100,
                progressKey: 'coins',
                goal: 100
            },
            {
                id: 'established-clicker',
                name: 'Established Clicker',
                description: 'Hit 1,000 coins. You’re getting the hang of this!',
                icon: 'fa-thumbs-up',
                condition: (state) => state.coins >= 1000,
                progressKey: 'coins',
                goal: 1000
            },
            {
                id: 'wealthy',
                name: 'Wealthy',
                description: 'Amass 100,000 coins. Now that’s serious dough!',
                icon: 'fa-hand-holding-dollar',
                condition: (state) => state.coins >= 1e5,
                progressKey: 'coins',
                goal: 1e5
            },
            {
                id: 'super-rich',
                name: 'Super Rich',
                description: '10 million coins is no joke—welcome to the big leagues!',
                icon: 'fa-piggy-bank',
                condition: (state) => state.coins >= 1e7,
                progressKey: 'coins',
                goal: 1e7
            },
            {
                id: 'the-1-percent',
                name: 'The 1 Percent',
                description: '100 million coins sets you apart from mere mortals!',
                icon: 'fa-diamond',
                condition: (state) => state.coins >= 1e8,
                progressKey: 'coins',
                goal: 1e8
            },
            {
                id: 'billionaire',
                name: 'Billionaire',
                description: 'Reach 1,000,000,000 coins. A whole new level of wealth!',
                icon: 'fa-building',
                condition: (state) => state.coins >= 1e9,
                progressKey: 'coins',
                goal: 1e9
            },
            {
                id: 'multi-billionaire',
                name: 'Multi-Billionaire',
                description: '10,000,000,000 coins. You can buy entire planets—almost!',
                icon: 'fa-landmark',
                condition: (state) => state.coins >= 1e10,
                progressKey: 'coins',
                goal: 1e10
            },
            {
                id: 'trillionaire',
                name: 'Trillionaire',
                description: 'You’ve reached a trillion coins. That’s a thousand billions!',
                icon: 'fa-crown',
                condition: (state) => state.coins >= 1e12,
                progressKey: 'coins',
                goal: 1e12
            },
            {
                id: 'the-elite',
                name: 'The Elite',
                description: 'At 100 trillion coins, you’re basically unstoppable!',
                icon: 'fa-chess-king',
                condition: (state) => state.coins >= 1e14,
                progressKey: 'coins',
                goal: 1e14
            },
            {
                id: 'cosmic-mogul',
                name: 'Cosmic Mogul',
                description: '10 quadrillion coins. You might as well own the galaxy!',
                icon: 'fa-earth-americas',
                condition: (state) => state.coins >= 1e16,
                progressKey: 'coins',
                goal: 1e16
            },
            {
                id: 'level-10',
                name: 'Rookie Adventurer',
                description: 'Reach level 10. You’ve survived the tutorial!',
                icon: 'fa-chart-line',
                condition: (state) => state.level >= 10
            },
            {
                id: 'level-25',
                name: 'Adept Adventurer',
                description: 'Reach level 25. The mid-game awaits!',
                icon: 'fa-medal',
                condition: (state) => state.level >= 25
            },
            {
                id: 'level-50',
                name: 'Advanced Adventurer',
                description: 'Reach level 50. You’re rising through the ranks!',
                icon: 'fa-dumbbell',
                condition: (state) => state.level >= 50
            },
            {
                id: 'level-75',
                name: 'Elite Adventurer',
                description: 'Reach level 75. Only the best get this far!',
                icon: 'fa-bolt',
                condition: (state) => state.level >= 75
            },
            {
                id: 'level-100',
                name: 'Master Adventurer',
                description: 'Reach level 100. The game is yours to conquer!',
                icon: 'fa-shield-halved',
                condition: (state) => state.level >= 100
            },
            {
                id: 'rebirth-1',
                name: 'First Rebirth',
                description: 'Perform your first Rebirth. It’s like starting anew—only stronger!',
                icon: 'fa-redo-alt',
                condition: (state) => state.rebirths >= 1
            },
            {
                id: 'rebirth-5',
                name: 'Five Rebirths',
                description: 'You’ve restarted life 5 times now. Nothing can hold you back!',
                icon: 'fa-sync-alt',
                condition: (state) => state.rebirths >= 5
            },
            {
                id: 'rebirth-10',
                name: 'Ten Rebirths',
                description: 'Ten times reborn—ten times the wisdom and power!',
                icon: 'fa-undo-alt',
                condition: (state) => state.rebirths >= 10
            },
            {
                id: 'rebirth-25',
                name: 'Twenty-Five Rebirths',
                description: '25 rebirths is no accident. You’re a master of repetition!',
                icon: 'fa-recycle',
                condition: (state) => state.rebirths >= 25
            },
            {
                id: 'rebirth-50',
                name: 'Fifty Rebirths',
                description: '50 rebirths—like a phoenix rising again and again!',
                icon: 'fa-infinity',
                condition: (state) => state.rebirths >= 50
            }
        ];

        function init() {
            loadGame();
            initUpgradeCosts();
            renderUpgrades();
            renderAchievements();
            setupEventListeners();
            updateUI();
            startGameLoop();
        }

        function initUpgradeCosts() {
            upgradesConfig.forEach(upg => {
                if (gameState.upgradeCosts[upg.id] == null) {
                    gameState.upgradeCosts[upg.id] = upg.baseCost;
                }
            });
        }

        function startGameLoop() {
            setInterval(() => {
                gameState.coins += getAutoIncome();
                gameState.exp += getAutoIncome() * 0.1;
                checkLevelUp();
                checkAchievements();
                updateUI();
                saveGame();
            }, 1000);
        }

        function renderUpgrades() {
            const container = document.getElementById('upgrades-container');
            container.innerHTML = '';

            upgradesConfig.forEach(upg => {
                // 1) If there's a prerequisite, check if it's met
                if (upg.prerequisite) {
                    const { id: reqId, level: reqLevel } = upg.prerequisite;
                    const actualLvl = gameState.upgrades[reqId] || 0;
                    if (actualLvl < reqLevel) {
                        // haven't met the prereq
                        return;
                    }
                }

                // 2) If there's an evolution rule, and we've reached that level, skip rendering it
                const lvl = gameState.upgrades[upg.id] || 0;
                if (upg.evolutionLevel && lvl >= upg.evolutionLevel) {
                    // means it's "evolved," so don't render
                    return;
                }

                // 3) If we pass these checks, we do render the card
                const currentCost = gameState.upgradeCosts[upg.id];
                const cardHtml = `
<div class="upgrade-card" data-id="${upg.id}">
    <i class="fas fa-rocket upgrade-icon"></i>
    <div class="upgrade-name-level">
        <h3>${upg.name}</h3>
        <div class="upgrade-level-badge">Lvl ${lvl}</div>
    </div>
    <p class="upgrade-cost">
        <i class="fas fa-coins"></i> ${formatNumber(currentCost)}
    </p>
    <div class="upgrade-actions">
        <button class="upgrade-info-button" onclick="showUpgradeDetails('${upg.id}')">
            <i class="fas fa-info"></i>
        </button>
        <button class="upgrade-buy-button" onclick="buyUpgrade('${upg.id}')">
            <i class="fas fa-cart-plus"></i> Buy
        </button>
    </div>
</div>
`;
                container.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        function showNotification(type, message) {
            const container = document.getElementById('notification-container');

            // Determine icon based on type
            const icon = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                info: 'fas fa-info-circle'
            }[type] || 'fas fa-info-circle';

            // Create the notification element
            const notification = document.createElement('div');
            notification.classList.add('notification');
            notification.innerHTML = `
        <i class="${icon}"></i>
        <div class="notification-text">${message}</div>
    `;

            // Append the notification to the container
            container.appendChild(notification);

            // Trigger fade-in animation
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.pointerEvents = 'all';
            }, 10);

            // Remove the notification after 4 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.pointerEvents = 'none';
                setTimeout(() => container.removeChild(notification), 400);
            }, 4000);
        }

        function showUpgradeDetails(id) {
            const upg = upgradesConfig.find(u => u.id === id);
            if (!upg) return;

            // Get evolution target details
            let evolutionDisplay = '';
            if (upg.evolutionTarget) {
                const targetUpgrade = upgradesConfig.find(u => u.id === upg.evolutionTarget);
                const currentLevel = gameState.upgrades[upg.id] || 0;
                const levelsRemaining = upg.evolutionLevel - currentLevel;

                evolutionDisplay = `
            <div class="stat-item">
                <span class="stat-label">Evolves Into</span>
                <span class="stat-value">${targetUpgrade ? targetUpgrade.name : 'Next Tier'}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Levels to Evolve</span>
                <span class="stat-value">${Math.max(levelsRemaining, 0)}</span>
            </div>
        `;
            }

            const modalContent = `
        <div class="upgrade-details-header">
            <i class="fas fa-rocket upgrade-details-icon"></i>
            <h2>${upg.name}</h2>
        </div>
        <div class="upgrade-stats">
            ${upg.income ? `<div class="stat-item">
                <span class="stat-label">Income</span>
                <span class="stat-value">+${upg.income}/sec</span>
            </div>` : ''}
            ${upg.multiplier ? `<div class="stat-item">
                <span class="stat-label">Multiplier</span>
                <span class="stat-value">x${upg.multiplier}</span>
            </div>` : ''}
            ${evolutionDisplay}
            <div class="stat-item">
                <span class="stat-label">Current Level</span>
                <span class="stat-value">${gameState.upgrades[upg.id] || 0}</span>
            </div>
        </div>
        <p>${upg.description || 'Enhances your clicking power and production capabilities.'}</p>
    `;

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
        <div class="modal-content upgrade-details-modal">
            ${modalContent}
        </div>
    `;

            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });

            document.body.appendChild(modal);
        }

        function buyUpgrade(id) {
            const upg = upgradesConfig.find(u => u.id === id);
            if (!upg) return;

            const cost = gameState.upgradeCosts[id];
            if (gameState.coins >= cost) {
                gameState.coins -= cost;
                const oldLevel = gameState.upgrades[id] || 0;
                gameState.upgrades[id] = oldLevel + 1;
                // up the cost
                gameState.upgradeCosts[id] = Math.ceil(cost * 1.8);

                animatePurchase(id);
                updateUpgradesUI();  // calls renderUpgrades() as well

                // optional: if we want to auto-hide the old upgrade when it evolves,
                // we rely on the logic in renderUpgrades() that checks evolutionLevel
            }
        }

        function updateUI() {
            document.getElementById('coin-count').textContent = formatNumber(gameState.coins);
            document.getElementById('exp-count').textContent = formatNumber(gameState.exp) + ' EXP';
            document.getElementById('rebirth-counter').textContent = 'Rebirths: ' + gameState.rebirths;
            updateProgressBar();
            //updateUpgradesUI(); // which calls renderUpgrades()
        }

        function updateUpgradesUI() {
            renderUpgrades();
        }

        function formatNumber(n) {
            if (n < 1000) return n.toFixed(0);
            const suffixes = ['', 'K', 'M', 'B', 'T'];
            let i = 0;
            while (n >= 1000 && i < suffixes.length - 1) {
                n /= 1000;
                i++;
            }
            return n.toFixed(2) + suffixes[i];
        }

        // Achievements
        function checkAchievements() {
            achievementsConfig.forEach(ach => {
                if (!gameState.achievements[ach.id] && ach.condition(gameState)) {
                    gameState.achievements[ach.id] = true;
                    showAchievementPopup(ach);
                }
            });
            renderAchievements();
        }

        function renderAchievements() {
            const container = document.getElementById('achievements-list');
            container.innerHTML = achievementsConfig
                .map(ach => {
                    const done = !!gameState.achievements[ach.id];
                    const icon = done ? 'fa-check-circle' : 'fa-lock';
                    const achIcon = ach.icon || 'fa-trophy';

                    let progressBar = '';
                    if (ach.progressKey && ach.goal) {
                        const val = gameState[ach.progressKey] || 0;
                        const clamp = Math.min(val, ach.goal);
                        const pct = (clamp / ach.goal) * 100;
                        progressBar = `
                        <div class="achievement-progress-container">
                            <div class="achievement-progress-fill" style="width: ${pct}%;"></div>
                        </div>
                        <div class="achievement-progress-text">
                            ${formatNumber(clamp)} / ${formatNumber(ach.goal)}
                        </div>
                    `;
                    }

                    return `
                <div class="achievement-card ${done ? 'completed' : 'locked'}" data-id="${ach.id}">
                    <div class="achievement-top-row">
                        <i class="achievement-icon fas ${achIcon}"></i>
                        <div class="achievement-content">
                            <h4 class="achievement-title">${ach.name}</h4>
                            <p class="achievement-description">${ach.description || ''}</p>
                        </div>
                        <div class="achievement-status">
                            <i class="fas ${icon}"></i>
                        </div>
                    </div>
                    ${progressBar}
                </div>
                `;
                })
                .join('');
        }

        function showAchievementPopup(ach) {
            const popup = document.getElementById('achievement-popup');
            popup.querySelector('.popup-description').textContent = ach.name;
            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 3000);

            confetti({
                particleCount: 80,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Level
        function checkLevelUp() {
            const needed = 100 * Math.pow(1.2, gameState.level - 1);
            if (gameState.exp >= needed) {
                gameState.exp -= needed;
                gameState.level++;

                const progressContainer = document.querySelector('.progress-container');

                // Force animation restart
                progressContainer.classList.remove('level-up');
                void progressContainer.offsetWidth; // Trigger reflow
                progressContainer.classList.add('level-up');

                // Confetti with optimized timing
                requestAnimationFrame(() => {
                    confetti({
                        particleCount: 80,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#7c3aed', '#ff6b6b'],
                        disableForReducedMotion: true
                    });
                });
            }
        }
        function updateProgressBar() {
            const expNeeded = 100 * Math.pow(1.2, gameState.level - 1);
            const currentExpInLevel = gameState.exp % expNeeded;
            const progress = (currentExpInLevel / expNeeded) * 100;

            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');

            // Update progress bar width
            progressBar.style.width = `${progress}%`;

            // Update progress text
            progressText.textContent = `Level ${gameState.level} - ${Math.floor(progress)}%`;

        }

        // Click Gains
        function getClickValue() {
            // base click of 1, multiplied by (rebirths + 1), 
            // multiplied by 1.5^(clickMult level):
            const baseClick = 1;
            const clickMultLevel = gameState.upgrades['click-mult'] || 0;
            return (gameState.rebirths + 1) * baseClick * Math.pow(1.5, clickMultLevel);
        }

        function getAutoIncome() {
            const autoClickLevel = gameState.upgrades['auto-click'] || 0;
            const rebirthMultiplier = gameState.rebirths + 1; // Multiplier starts at 1 when rebirths are 0
            return autoClickLevel * rebirthMultiplier;
        }

        function animatePurchase(id) {
            const card = document.querySelector(`.upgrade-card[data-id="${id}"]`);
            if (!card) return;
            card.animate(
                [
                    { transform: 'scale(1)' },
                    { transform: 'scale(1.1)' },
                    { transform: 'scale(1)' }
                ],
                { duration: 300 }
            );
        }

        // Save/Load
        function saveGame() {
            localStorage.setItem('neonClickerSave', JSON.stringify(gameState));
        }

        function loadGame() {
            const saved = localStorage.getItem('neonClickerSave');
            if (saved) {
                gameState = JSON.parse(saved);
            }
        }

        // UI / Event Listeners
        function setupEventListeners() {
            document.getElementById('click-button').addEventListener('click', () => {
                const val = getClickValue();
                gameState.coins += val;
                gameState.exp += val * 0.2;
                updateUI();
            });

            ['settings', 'achievements', 'rebirth'].forEach(type => {
                const btn = document.getElementById(`${type}-button`);
                const modal = document.getElementById(`${type}-modal`);
                if (btn && modal) {
                    btn.addEventListener('click', () => {
                        if (type === 'rebirth') updateRebirthModal();
                        modal.style.display = 'flex';
                    });
                    modal.addEventListener('click', (e) => {
                        if (e.target === e.currentTarget) {
                            modal.style.display = 'none';
                        }
                    });
                }
            });

            document.getElementById('rebirth-confirm-button').addEventListener('click', doRebirth);
            document.getElementById('reset-game-button').addEventListener('click', resetGame);
            document.getElementById('save-game-button').addEventListener('click', () => {
                saveGame();
                showNotification('success', 'Game saved successfully!');
            });
        }

        function updateRebirthModal() {
            const needed = 100;
            const rebirthInfoEl = document.getElementById('rebirth-info');

            if (gameState.level >= needed) {
                rebirthInfoEl.innerHTML = `
            <p>You have reached Level <span>${gameState.level}</span>, which is enough to Rebirth!</p>
            <p>Rebirthing will reset your coins, EXP, and upgrades, but grant +1 Rebirth and permanent multipliers.</p>
        `;
            } else {
                const diff = needed - gameState.level;
                rebirthInfoEl.innerHTML = `
            <p>You need <span>${diff}</span> more level${diff > 1 ? 's' : ''} to unlock Rebirth.</p>
            <p>Reach Level 100 to unlock Rebirth!</p>
        `;
            }

            // Update the displayed bonuses based on rebirth count
            document.getElementById('rebirth-click-multiplier').textContent = `x${gameState.rebirths + 1}`;
            document.getElementById('rebirth-income-multiplier').textContent = `x${gameState.rebirths === 0 ? 1 : (gameState.rebirths * 1.5).toFixed(1)}`;
        }

        function doRebirth() {
            const needed = 100;
            if (gameState.level >= needed) {
                gameState.rebirths++;
                gameState.coins = 0;
                gameState.exp = 0;
                gameState.level = 1;
                gameState.upgrades = {};
                gameState.upgradeCosts = {};
                initUpgradeCosts();
                showNotification('success', 'Rebirth successful! Your journey begins anew.');
                updateUI();
            } else {
                showNotification('error', 'You need to reach a higher level to rebirth.');
            }
            document.getElementById('rebirth-modal').style.display = 'none';
        }

        function resetGame() {
            localStorage.removeItem('neonClickerSave');
            location.reload();
        }

        function init() {
            loadGame();
            initUpgradeCosts();
            renderUpgrades();
            renderAchievements();
            setupEventListeners();
            updateUI();
            startGameLoop();
        }

        init();
    </script>
</body>

</html>
