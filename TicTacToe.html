<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Multiplayer Tic-Tac-Toe</title>
    <style>
        /* Import Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        /* Reset and Basic Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            /* Dark Blue Gradient */
            overflow: hidden;
            color: #ecf0f1;
        }

        h1 {
            color: #ecf0f1;
            text-align: center;
            margin-bottom: 20px;
            animation: fadeInDown 1s;
            font-size: 2.5rem;
        }

        /* Container */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 90%;
            max-width: 600px;
            animation: fadeInUp 1s;
        }

        /* Status Indicators */
        .status-indicators {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .status-chip {
            background: rgba(52, 73, 94, 0.8);
            backdrop-filter: blur(10px);
            color: #ecf0f1;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            font-size: 1rem;
            display: flex;
            align-items: center;
            transition: background 0.3s, color 0.3s;
        }

        .status-chip #currentPlayerDisplay {
            font-weight: 600;
            margin-left: 15px;
            /* Increased space between label and value */
        }

        .status-chip #currentPlayerDisplayPP {
            font-weight: 600;
            margin-left: 5px;
            /* Increased space between label and value */
        }

        .status-chip #playerRoleDisplay {
            font-weight: 600;
            margin-left: 5px;
            /* Increased space between label and value */
        }

        /* Highlight Current Player Chip */
        .status-chip.current-turn {
            background: linear-gradient(45deg, #2980b9, #3498db);
            /* Blue Gradient */
            color: #ecf0f1;
        }

        /* Highlight Player Role Chip */
        .status-chip.player-role {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            /* Gray Gradient */
            color: #ecf0f1;
        }

        /* Scoreboard Styles */
        .scoreboard {
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ecf0f1;
            margin-bottom: 20px;
            font-size: 1.2rem;
            animation: fadeInDown 1s;
        }

        .scoreboard .player {
            background: rgba(52, 73, 94, 0.8);
            padding: 15px 25px;
            margin: 0 10px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            min-width: 160px;
            justify-content: center;
            position: relative;
            transition: background 0.3s;
        }

        .scoreboard .player:hover {
            background: rgba(52, 73, 94, 1);
        }

        .scoreboard .player-name {
            margin-right: 10px;
            font-weight: 600;
            font-size: 1rem;
        }

        .scoreboard .player-score {
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Game Board Styles */
        .game {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            gap: 15px;
            justify-content: center;
        }

        .cell {
            width: 100px;
            height: 100px;
            background: rgba(44, 62, 80, 0.8);
            /* Dark Blue for Cells */
            border-radius: 15px;
            font-size: 64px;
            color: transparent;
            /* Start with transparent text */
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1000px;
            transform-style: preserve-3d;
            position: relative;
            cursor: pointer;
            transition: background 0.3s, color 0.3s, transform 0.6s;
        }

        .cell:hover {
            background: rgba(44, 62, 80, 1);
            transform: scale(1.05);
        }

        .cell.flipped {
            animation: flip 0.6s forwards;
        }

        @keyframes flip {
            0% {
                transform: rotateY(0deg);
            }

            100% {
                transform: rotateY(360deg);
            }
        }

        .cell.show-letter {
            color: #2980b9;
            /* Blue for X */
            /* For X */
            font-weight: 600;
        }

        .cell.O.show-letter {
            color: #95a5a6;
            /* Gray for O */
            /* For O */
            font-weight: 600;
        }

        .cell.win {
            background: #27ae60 !important;
            /* Green color for win */
            box-shadow: 0 0 15px #2ecc71;
            transform: scale(1.1);
        }

        .cell.draw {
            background: #f39c12 !important;
            /* Yellow color for draw */
            box-shadow: 0 0 15px #f1c40f;
            transform: scale(1.1);
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.5s;
        }

        .modal-content {
            background-color: #2c3e50;
            /* Dark Blue */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 40px 30px;
            border: none;
            width: 90%;
            max-width: 450px;
            color: #ecf0f1;
            text-align: center;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.5s;
        }

        .modal-content .winner-symbol {
            font-size: 80px;
            margin-bottom: 20px;
            animation: scaleUp 0.5s;
        }

        .modal-content button {
            margin-top: 20px;
            padding: 12px 25px;
            background: linear-gradient(45deg, #2980b9, #3498db);
            /* Blue Gradient */
            color: #ecf0f1;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            margin-right: 10px;
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        /* Continue Button Specific Styles */
        .modal-content #continueButton.continue-clicked {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            /* Red Gradient */
            color: #ecf0f1;
        }

        /* Return to Menu Button Specific Styles */
        .modal-content #returnToMenuButton {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            /* Gray Gradient */
        }

        .modal-content button:hover {
            background: linear-gradient(45deg, #3498db, #2980b9);
            transform: translateY(-3px);
        }

        #gameOverMessage {
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        /* Fade In Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Modal Fade In Animation */
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }

            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        /* Scale Up Animation */
        @keyframes scaleUp {
            from {
                transform: scale(0);
            }

            to {
                transform: scale(1);
            }
        }

        /* Game Menu Modal Styles */
        #gameMenu .modal-content {
            max-width: 500px;
            background: rgba(44, 62, 80, 0.9);
            /* Dark Blue */
            animation: slideIn 0.7s;
            position: relative;
            overflow: hidden;
            border-radius: 15px;
        }

        #gameMenu input[type="text"] {
            width: 80%;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 30px;
            border: none;
            transition: box-shadow 0.3s, transform 0.2s;
            font-size: 1rem;
            background: rgba(236, 240, 241, 0.2);
            color: #ecf0f1;
        }

        #gameMenu input[type="text"]::placeholder {
            color: #bdc3c7;
            font-weight: 500;
        }

        #gameMenu input[type="text"]:focus {
            box-shadow: 0 0 10px #3498db;
            outline: none;
            transform: scale(1.02);
        }

        #gameMenu button {
            padding: 12px 25px;
            margin: 10px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            background: linear-gradient(45deg, #2980b9, #3498db);
            /* Blue Gradient */
            color: #ecf0f1;
            transition: background 0.3s, transform 0.2s;
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        #gameMenu button:hover {
            background: linear-gradient(45deg, #3498db, #2980b9);
            transform: translateY(-3px);
        }

        #menuMessage {
            color: #e74c3c;
            margin-top: 15px;
            font-size: 1rem;
            min-height: 20px;
            font-weight: 500;
        }

        /* Slide In Animation */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-100px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Styles */
        @media (max-width: 768px) {

            /* Hide scoreboard on small screens */
            .scoreboard {
                flex-direction: column;
            }

            .scoreboard .player {
                margin: 10px 0;
            }

            .game {
                grid-template-columns: repeat(3, 80px);
                gap: 10px;
            }

            .cell {
                width: 80px;
                height: 80px;
                font-size: 48px;
            }

            .modal-content {
                width: 90%;
            }

            #gameMenu input[type="text"] {
                width: 90%;
            }

            .status-indicators {
                flex-direction: column;
                gap: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .scoreboard .player-score {
                font-size: 1.3rem;
            }

            #gameOverMessage {
                font-size: 1.3rem;
            }
        }

        /* Pass-and-Play Specific Styles */
        .pp-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .pp-controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
        }

        .pp-controls button {
            padding: 12px 25px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            background: linear-gradient(45deg, #2980b9, #3498db);
            /* Blue Gradient */
            color: #ecf0f1;
            transition: background 0.3s, transform 0.2s;
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .pp-controls button:hover {
            background: linear-gradient(45deg, #3498db, #2980b9);
            transform: translateY(-3px);
        }

        /* Message for Other Player Returning to Menu */
        #otherPlayerLeftMessage {
            color: #e67e22;
            margin-top: 15px;
            font-size: 1rem;
            min-height: 20px;
            font-weight: 500;
            display: none;
        }

        /* Moving Elements for Game Menu */
        #gameMenu .moving-background {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1), transparent 70%);
            animation: rotateBackground 20s linear infinite;
            z-index: -1;
        }

        @keyframes rotateBackground {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Additional Styles for Enhanced Input Screen */
        #gameMenu .modal-content {
            position: relative;
            overflow: hidden;
        }

        #gameMenu .moving-background::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            animation: pulsate 10s ease-in-out infinite;
        }

        @keyframes pulsate {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0.8;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 0.5;
            }
        }
    </style>
    <!-- Optional: Font Awesome for Icons -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pO8XRcJFvSePHap1BGk68iImhU1z6SEvr0XcCucFF0Gk+6fxJ3b44dja6xkSfaURy3RqlRT7qVtcW9E1YzK4ow==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

    <!-- Game Menu Modal -->
    <div id="gameMenu" class="modal">
        <div class="modal-content">
            <!-- Moving Background Elements -->
            <div class="moving-background"></div>

            <h2>Welcome to Tic-Tac-Toe</h2>
            <div class="pp-container">
                <button id="createGameButton">Create Online Game</button>
                <hr style="width: 80%; border: 1px solid rgba(236, 240, 241, 0.3); margin: 20px 0;">
                <input type="text" id="joinGameInput" placeholder="Enter Game Code">
                <button id="joinGameButton">Join Online Game</button>
                <hr style="width: 80%; border: 1px solid rgba(236, 240, 241, 0.3); margin: 20px 0;">
                <button id="passAndPlayButton">Play Pass-and-Play</button>
                <p id="menuMessage"></p>
            </div>
        </div>
    </div>

    <!-- Existing Game Container -->
    <div class="container" style="display: none;">
        <h1>Tic-Tac-Toe</h1>

        <!-- Status Indicators -->
        <div class="status-indicators">
            <div class="status-chip current-turn" id="currentTurnChip">
                Current Turn: <span id="currentPlayerDisplay">X</span>
            </div>
            <div class="status-chip player-role" id="playerRoleChip">
                You are: <span id="playerRoleDisplay">X</span>
            </div>
        </div>

        <div class="scoreboard">
            <div class="player" id="playerX">
                <span class="player-name">Player X: </span>
                <span class="player-score" id="scoreX">0</span>
            </div>
            <div class="player" id="playerO">
                <span class="player-name">Player O: </span>
                <span class="player-score" id="scoreO">0</span>
            </div>
        </div>
        <div class="game" id="game">
            <!-- Generate 9 cells -->
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
        </div>
        <!-- Game Over Modal -->
        <div id="gameOverModal" class="modal">
            <div class="modal-content">
                <div class="winner-symbol" id="winnerSymbol">
                    <!-- Symbol will be inserted here -->
                </div>
                <span id="gameOverMessage" style="font-size: 1.5rem;"></span>
                <br>
                <button id="continueButton">Continue</button>
                <button id="returnToMenuButton">Return to Menu</button>
                <p id="otherPlayerLeftMessage">The other player has returned to the main menu.</p>
            </div>
        </div>
    </div>

    <!-- Pass-and-Play Container -->
    <div class="container" id="passAndPlayContainer" style="display: none;">
        <h1>Tic-Tac-Toe (Pass-and-Play)</h1>

        <!-- Turn Indicator -->
        <div class="status-indicators">
            <div class="status-chip current-turn" id="currentTurnChipPP">
                Current Turn: <span id="currentPlayerDisplayPP">X</span>
            </div>
        </div>

        <div class="scoreboard">
            <div class="player" id="playerXPP">
                <span class="player-name">Player X: </span>
                <span class="player-score" id="scoreXPP">0</span>
            </div>
            <div class="player" id="playerOPP">
                <span class="player-name">Player O: </span>
                <span class="player-score" id="scoreOPP">0</span>
            </div>
        </div>
        <div class="game" id="gamePP">
            <!-- Generate 9 cells -->
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
            <div class="cell" data-cell></div>
        </div>
        <!-- Game Over Modal for Pass-and-Play -->
        <div id="gameOverModalPP" class="modal">
            <div class="modal-content">
                <div class="winner-symbol" id="winnerSymbolPP">
                    <!-- Symbol will be inserted here -->
                </div>
                <span id="gameOverMessagePP" style="font-size: 1.5rem;"></span>
                <br>
                <button id="continueButtonPP">Continue</button>
                <button id="returnToMenuButtonPP">Return to Menu</button>
            </div>
        </div>
    </div>

    <!-- Include Canvas Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDTxkGSQKTuw0M-cz9Jr6FNNlV3iLi-S88",
            authDomain: "tictactoe-e56fa.firebaseapp.com",
            projectId: "tictactoe-e56fa",
            storageBucket: "tictactoe-e56fa.appspot.com",
            messagingSenderId: "703789364594",
            appId: "1:703789364594:web:0ecfab3356f610615419eb",
            measurementId: "G-B5DYX1R05Z"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // DOM Elements for Online Multiplayer
        const gameMenu = document.getElementById('gameMenu');
        const createGameButton = document.getElementById('createGameButton');
        const joinGameButton = document.getElementById('joinGameButton');
        const joinGameInput = document.getElementById('joinGameInput');
        const passAndPlayButton = document.getElementById('passAndPlayButton');
        const menuMessage = document.getElementById('menuMessage');

        const container = document.querySelector('.container:not(#passAndPlayContainer)');
        const cells = document.querySelectorAll('#game .cell');
        const gameOverModal = document.getElementById('gameOverModal');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const winnerSymbolElement = document.getElementById('winnerSymbol');
        const continueButton = document.getElementById('continueButton');
        const returnToMenuButton = document.getElementById('returnToMenuButton');
        const otherPlayerLeftMessage = document.getElementById('otherPlayerLeftMessage');

        const scoreXElement = document.getElementById('scoreX');
        const scoreOElement = document.getElementById('scoreO');
        const playerXElement = document.getElementById('playerX');
        const playerOElement = document.getElementById('playerO');

        const turnIndicator = document.getElementById('currentPlayerDisplay');
        const playerRoleDisplay = document.getElementById('playerRoleDisplay');

        // DOM Elements for Pass-and-Play
        const passAndPlayContainer = document.getElementById('passAndPlayContainer');
        const cellsPP = document.querySelectorAll('#gamePP .cell');
        const gameOverModalPP = document.getElementById('gameOverModalPP');
        const gameOverMessagePP = document.getElementById('gameOverMessagePP');
        const winnerSymbolElementPP = document.getElementById('winnerSymbolPP');
        const continueButtonPP = document.getElementById('continueButtonPP');
        const returnToMenuButtonPP = document.getElementById('returnToMenuButtonPP');

        const scoreXPPElement = document.getElementById('scoreXPP');
        const scoreOPPElement = document.getElementById('scoreOPP');
        const playerXPPElement = document.getElementById('playerXPP');
        const playerOPPElement = document.getElementById('playerOPP');

        const turnIndicatorPP = document.getElementById('currentPlayerDisplayPP');

        // Game Variables for Online Multiplayer
        let currentPlayer = 'X';
        let gameCode = null;
        let playerSymbol = null;
        let gameRef = null;

        // Game Variables for Pass-and-Play
        let currentPlayerPP = 'X';
        let gameStatePP = Array(9).fill(null);
        let scoreXPP = 0;
        let scoreOPP = 0;

        // Event Listeners
        createGameButton.addEventListener('click', createGame);
        joinGameButton.addEventListener('click', joinGame);
        passAndPlayButton.addEventListener('click', startPassAndPlay);
        continueButton.addEventListener('click', handleContinueButton);
        returnToMenuButton.addEventListener('click', returnToMenu);

        continueButtonPP.addEventListener('click', continueGamePP);
        returnToMenuButtonPP.addEventListener('click', returnToMenuPP);

        // Display the Game Menu Modal on Page Load
        window.onload = function () {
            console.log("Page loaded. Displaying Game Menu.");
            gameMenu.style.display = 'block';
        }

        // Function to Generate Custom Game Codes
        function generateGameCode() {
            const adjectives = [
                "expert", "happy", "bright", "quick", "silent", "fancy", "clever", "brave", "calm", "eager",
                "adventurous", "affectionate", "agreeable", "alert", "amazing", "ambitious", "amiable", "amused", "artistic", "athletic",
                "awesome", "balanced", "beautiful", "blissful", "bold", "brilliant", "bubbly", "busy", "charming", "cheerful",
                "chic", "classy", "confident", "considerate", "cool", "courageous", "creative", "cute", "daring", "dazzling",
                "delightful", "determined", "diligent", "dynamic", "elegant", "energetic", "enthusiastic", "excellent", "excited", "fabulous",
                "faithful", "fantastic", "fearless", "friendly", "funny", "generous", "gentle", "glamorous", "graceful", "gracious",
                "gregarious", "happy-go-lucky", "hardworking", "harmonious", "helpful", "hilarious", "honest", "hopeful", "imaginative", "impressive",
                "independent", "ingenious", "innovative", "inspiring", "intelligent", "intuitive", "inventive", "jolly", "jovial", "joyful",
                "jubilant", "keen", "kind", "knowledgeable", "lively", "lovable", "lovely", "loyal", "lucky", "magnificent",
                "marvelous", "merry", "meticulous", "motivated", "neat", "nice", "optimistic", "outgoing", "outstanding", "passionate",
                "patient", "peaceful", "perceptive", "persistent", "playful", "pleasant", "polite", "positive", "powerful", "practical",
                "precious", "proactive", "productive", "proud", "punctual", "radiant", "reliable", "remarkable", "resilient", "resourceful",
                "respectful", "responsible", "romantic", "sassy", "sensible", "sensitive", "sincere", "skillful", "smart", "sociable",
                "spectacular", "spirited", "splendid", "spontaneous", "sporty", "stable", "strong", "stunning", "successful", "supportive",
                "sweet", "talented", "thoughtful", "trustworthy", "unique", "upbeat", "valiant", "vibrant", "vigorous", "vivacious",
                "warm", "witty", "wonderful", "youthful", "zealous", "zesty", "zippy", "admirable", "adroit", "adventurous",
                "affable", "affectionate", "agreeable", "alert", "alluring", "amazing", "ambitious", "amiable", "amicable", "amused",
                "angelic", "animated", "appreciative", "articulate", "artistic", "assertive", "astute", "athletic", "attentive", "attractive",
                "awesome", "balanced", "beautiful", "beloved", "benevolent", "blissful", "bold", "brave", "bright", "brilliant",
                "bubbly", "busy", "calm", "capable", "carefree", "careful", "caring", "charming", "cheerful", "chic",
                "classy", "clever", "compassionate", "competent", "confident", "considerate", "cool", "courageous", "courteous", "creative",
                "cute", "daring", "dazzling", "dedicated", "delightful", "dependable", "determined", "diligent", "diplomatic", "discerning",
                "dynamic", "eager", "easygoing", "efficient", "elegant", "eloquent", "empathetic", "energetic", "engaging", "enthusiastic",
                "excellent", "excited", "exuberant", "fabulous", "fair", "faithful", "fantastic", "fearless", "friendly", "funny",
                "generous", "gentle", "genuine", "glamorous", "graceful", "gracious", "gregarious", "happy", "happy-go-lucky", "hardworking",
                "harmonious", "helpful", "hilarious", "honest", "hopeful", "humble", "humorous", "imaginative", "impressive", "independent",
                "ingenious", "innovative", "inquisitive", "inspiring", "intelligent", "intuitive", "inventive", "jolly", "jovial", "joyful",
                "jubilant", "keen", "kind", "knowledgeable", "lively", "lovable", "lovely", "loyal", "lucky", "magnificent",
                "marvelous", "merry", "meticulous", "motivated", "neat", "nice", "optimistic", "outgoing", "outstanding", "passionate",
                "patient", "peaceful", "perceptive", "persistent", "playful", "pleasant", "polite", "positive", "powerful", "practical",
                "precious", "proactive", "productive", "proud", "punctual", "radiant", "reliable", "remarkable", "resilient", "resourceful",
                "respectful", "responsible", "romantic", "sassy", "sensible", "sensitive", "sincere", "skillful", "smart", "sociable",
                "spectacular", "spirited", "splendid", "spontaneous", "sporty", "stable", "strong", "stunning", "successful", "supportive",
                "sweet", "talented", "thoughtful", "trustworthy", "unique", "upbeat", "valiant", "vibrant", "vigorous", "vivacious",
                "warm", "witty", "wonderful", "youthful", "zealous", "zesty", "zippy"
            ];
            const nouns = [
                "squid", "lion", "tiger", "eagle", "shark", "wolf", "bear", "fox", "hawk", "owl",
                "ant", "bat", "cat", "dog", "elk", "frog", "goat", "hen", "ibex", "jay",
                "kite", "lynx", "mole", "newt", "orca", "pig", "quail", "rat", "seal", "toad",
                "urchin", "vole", "wren", "yak", "zebra", "ape", "bison", "crab", "dove", "eel",
                "finch", "gull", "hare", "iguana", "jackal", "koala", "lemur", "mink", "narwhal", "otter",
                "panda", "quokka", "raven", "sloth", "tuna", "viper", "walrus", "xerus", "yak", "zebu",
                "albatross", "buffalo", "cheetah", "dolphin", "elephant", "flamingo", "gazelle", "hippo", "ibis", "jaguar",
                "kangaroo", "lemur", "meerkat", "narwhal", "octopus", "penguin", "quokka", "raccoon", "salamander", "tarantula",
                "vulture", "wombat", "xenops", "yak", "zebu", "armadillo", "beaver", "chinchilla", "dingo", "emu",
                "ferret", "gecko", "hedgehog", "impala", "jellyfish", "kiwi", "llama", "manatee", "numbat", "opossum",
                "platypus", "quoll", "reindeer", "skunk", "tapir", "vicuna", "wolverine", "xenopus", "yak", "zebu",
                "anaconda", "baboon", "caribou", "dugong", "echidna", "falcon", "giraffe", "hyena", "ibex", "jackrabbit",
                "kudu", "lemur", "mongoose", "nighthawk", "ocelot", "porcupine", "quail", "robin", "swan", "tortoise",
                "viper", "weasel", "xerus", "yak", "zebu", "alligator", "badger", "camel", "deer", "eagle",
                "fox", "goose", "heron", "iguana", "jaguar", "koala", "lemur", "marmot", "narwhal", "ostrich",
                "peacock", "quokka", "rattlesnake", "seal", "tiger", "vulture", "whale", "xenops", "yak", "zebu",
                "alpaca", "bison", "cheetah", "dingo", "elephant", "flamingo", "gorilla", "hippopotamus", "ibis", "jellyfish",
                "kangaroo", "lemur", "mole", "newt", "octopus", "penguin", "quail", "raccoon", "salamander", "tarantula",
                "vulture", "wombat", "xenops", "yak", "zebu", "antelope", "buffalo", "cheetah", "dolphin", "elephant",
                "flamingo", "giraffe", "hippopotamus", "ibis", "jaguar", "kangaroo", "lemur", "mole", "newt", "octopus",
                "penguin", "quail", "raccoon", "salamander", "tarantula", "vulture", "wombat", "xenops", "yak", "zebu"
            ];
            const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            const number = Math.floor(100 + Math.random() * 900); // Generates a 3-digit number
            return `${adjective}${noun}${number}`;
        }

        // Function to Generate a Unique Game Code
        async function generateUniqueGameCode() {
            let code = generateGameCode();
            let exists = await checkGameCodeExists(code);
            let attempts = 1;
            while (exists && attempts < 5) { // Limit to 5 attempts to prevent infinite loops
                code = generateGameCode();
                exists = await checkGameCodeExists(code);
                attempts++;
            }
            if (exists) {
                throw new Error("Unable to generate a unique game code. Please try again.");
            }
            return code;
        }

        // Function to Check if a Game Code Already Exists
        function checkGameCodeExists(code) {
            return database.ref(`games/${code}`).once('value').then(snapshot => {
                return snapshot.exists();
            }).catch(error => {
                console.error("Error checking game code existence:", error);
                throw error;
            });
        }

        // Function to Create a New Online Game
        function createGame() {
            console.log("Creating a new online game...");
            generateUniqueGameCode().then(uniqueCode => {
                gameCode = uniqueCode;
                playerSymbol = 'X'; // Creator is always 'X'
                gameRef = database.ref(`games/${gameCode}`);

                // Initialize game data
                gameRef.set({
                    players: {
                        X: {
                            score: 0,
                            online: true
                        },
                        O: {
                            score: 0,
                            online: false
                        }
                    },
                    board: {
                        0: null,
                        1: null,
                        2: null,
                        3: null,
                        4: null,
                        5: null,
                        6: null,
                        7: null,
                        8: null
                    },
                    currentPlayer: 'X',
                    status: 'waiting', // waiting, in-progress, finished
                    continueFlags: {
                        X: false,
                        O: false
                    },
                    returnToMenuFlags: {
                        X: false,
                        O: false
                    }
                })
                    .then(() => {
                        // Handle Player X disconnect
                        gameRef.child('players/X/online').onDisconnect().set(false);

                        // Listen for game updates
                        listenForGameUpdates(gameRef);

                        // Display game code to the creator
                        menuMessage.style.color = '#2ecc71';
                        menuMessage.textContent = `Game created! Share this code with a friend to join: ${gameCode}`;
                        console.log(`Game created with code: ${gameCode}`);

                        // Set Player Role Display
                        setPlayerRoleDisplay();
                    })
                    .catch(error => {
                        console.error("Error initializing game data:", error);
                        menuMessage.style.color = '#e74c3c';
                        menuMessage.textContent = 'An error occurred while creating the game.';
                    });
            }).catch(error => {
                console.error("Error generating unique game code:", error);
                menuMessage.style.color = '#e74c3c';
                menuMessage.textContent = 'Unable to generate a unique game code. Please try again.';
            });
        }

        // Function to Join an Existing Online Game
        function joinGame() {
            const enteredCode = joinGameInput.value.trim();
            if (enteredCode === '') {
                menuMessage.style.color = '#e74c3c';
                menuMessage.textContent = 'Please enter a game code.';
                console.log("Join game failed: No game code entered.");
                return;
            }

            console.log(`Attempting to join online game with code: ${enteredCode}`);
            gameRef = database.ref(`games/${enteredCode}`);
            gameRef.once('value').then(snapshot => {
                if (snapshot.exists()) {
                    const gameData = snapshot.val();
                    if (gameData.status === 'finished') {
                        menuMessage.style.color = '#e74c3c';
                        menuMessage.textContent = 'Game has already finished.';
                        console.log("Join game failed: Game has already finished.");
                        return;
                    }

                    if (gameData.players.O.online) {
                        menuMessage.style.color = '#e74c3c';
                        menuMessage.textContent = 'Game is full.';
                        console.log("Join game failed: Game is full.");
                        return;
                    }

                    // Join as Player O
                    gameRef.child('players/O').update({
                        online: true
                    }).then(() => {
                        // Update game status to 'in-progress'
                        return gameRef.update({
                            status: 'in-progress'
                        });
                    }).then(() => {
                        gameCode = enteredCode;
                        playerSymbol = 'O';

                        // Handle Player O disconnect
                        gameRef.child('players/O/online').onDisconnect().set(false);

                        // Listen for game updates
                        listenForGameUpdates(gameRef);

                        menuMessage.style.color = '#2ecc71';
                        menuMessage.textContent = `Joined game ${gameCode} as Player O. Game has started.`;
                        console.log(`Joined game ${gameCode} as Player O.`);

                        // Set Player Role Display
                        setPlayerRoleDisplay();
                    }).catch(error => {
                        console.error("Error joining game:", error);
                        menuMessage.style.color = '#e74c3c';
                        menuMessage.textContent = 'An error occurred. Please try again.';
                    });
                } else {
                    menuMessage.style.color = '#e74c3c';
                    menuMessage.textContent = 'Game not found.';
                    console.log("Join game failed: Game not found.");
                }
            }).catch(error => {
                console.error("Error joining game:", error);
                menuMessage.style.color = '#e74c3c';
                menuMessage.textContent = 'An error occurred. Please try again.';
            });
        }

        // Function to Start Pass-and-Play Mode
        function startPassAndPlay() {
            console.log("Starting Pass-and-Play mode...");
            gameMenu.style.display = 'none';
            passAndPlayContainer.style.display = 'flex';
            initializePassAndPlay();
        }

        // Function to Initialize Pass-and-Play Mode
        function initializePassAndPlay() {
            // Reset game state
            gameStatePP = Array(9).fill(null);
            currentPlayerPP = 'X';
            scoreXPP = 0;
            scoreOPP = 0;
            updateBoardPP();

            // Update Turn Indicator
            turnIndicatorPP.textContent = currentPlayerPP;

            // Attach event listeners to Pass-and-Play cells
            cellsPP.forEach((cell, index) => {
                cell.addEventListener('click', () => handleCellClickPP(index));
            });
        }

        // Function to Handle Cell Clicks in Pass-and-Play
        function handleCellClickPP(index) {
            console.log(`Player ${currentPlayerPP} clicked cell ${index}`);
            if (gameStatePP[index] !== null) {
                alert('Cell already taken!');
                return;
            }

            gameStatePP[index] = currentPlayerPP;
            updateBoardPP();

            // Check for win or draw
            const winner = determineWinner(gameStatePP);
            if (winner) {
                if (winner === 'X') {
                    scoreXPP += 1;
                    scoreXPPElement.textContent = scoreXPP;
                } else {
                    scoreOPP += 1;
                    scoreOPPElement.textContent = scoreOPP;
                }
                showGameOverPP(winner);
                return;
            } else if (isBoardFull(gameStatePP)) {
                showGameOverPP(null);
                return;
            }

            // Switch Player
            currentPlayerPP = currentPlayerPP === 'X' ? 'O' : 'X';
            turnIndicatorPP.textContent = currentPlayerPP;
        }

        // Function to Update the Board UI in Pass-and-Play
        function updateBoardPP() {
            cellsPP.forEach((cell, index) => {
                const symbol = gameStatePP[index];
                cell.textContent = symbol ? symbol : '';
                if (symbol) {
                    cell.classList.add('show-letter', symbol);
                    cell.classList.add('flipped');
                } else {
                    cell.classList.remove('show-letter', 'X', 'O', 'flipped');
                    cell.textContent = '';
                }
            });
        }

        // Function to Show Game Over Modal in Pass-and-Play
        function showGameOverPP(winner) {
            if (winner) {
                gameOverMessagePP.textContent = `Player ${winner} Wins!`;
                winnerSymbolElementPP.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessagePP.textContent = "It's a Draw!";
                winnerSymbolElementPP.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModalPP.style.display = "block";
        }

        // Function to Continue Game in Pass-and-Play
        function continueGamePP() {
            console.log("Continuing Pass-and-Play game...");
            gameStatePP = Array(9).fill(null);
            currentPlayerPP = 'X';
            updateBoardPP();
            turnIndicatorPP.textContent = currentPlayerPP;
            gameOverModalPP.style.display = "none";
        }

        // Function to Return to Menu from Pass-and-Play
        function returnToMenuPP() {
            console.log("Returning to game menu from Pass-and-Play...");
            gameOverModalPP.style.display = 'none';
            passAndPlayContainer.style.display = 'none';
            gameMenu.style.display = 'block';

            // Detach event listeners
            cellsPP.forEach((cell, index) => {
                cell.removeEventListener('click', () => handleCellClickPP(index));
            });
        }

        // Function to Listen for Game Updates in Online Multiplayer
        function listenForGameUpdates(ref) {
            console.log("Setting up listener for game updates on:", ref.toString());

            // Detach existing listeners to prevent multiple attachments
            detachListeners(ref);

            // Listen for changes to the board
            ref.child('board').on('value', snapshot => {
                const board = snapshot.val();
                if (board) {
                    console.log("Board updated from Firebase:", board);
                    updateBoard(board);
                }
            }, error => {
                console.error("Error listening to board updates:", error);
            });

            // Listen for changes to the game status
            ref.child('status').on('value', snapshot => {
                const status = snapshot.val();
                console.log(`Game status updated to: ${status}`);
                if (status === 'finished') {
                    // Access the 'board' node
                    ref.child('board').once('value').then(boardSnapshot => {
                        const board = boardSnapshot.val();
                        const boardArray = Object.keys(board).sort((a, b) => a - b).map(key => board[key]);
                        const winner = determineWinner(boardArray);
                        handleOnlineGameOver(winner);
                    }).catch(error => {
                        console.error("Error fetching board data:", error);
                    });
                } else if (status === 'in-progress') {
                    if (container.style.display === 'none') {
                        startGame();
                    }
                }
            }, error => {
                console.error("Error listening to status updates:", error);
            });

            // Listen for changes to the currentPlayer
            ref.child('currentPlayer').on('value', snapshot => {
                const currentPlayerValue = snapshot.val();
                if (currentPlayerValue) {
                    currentPlayer = currentPlayerValue;
                    console.log(`Current Player updated to: ${currentPlayer}`);
                    turnIndicator.textContent = currentPlayer;

                    // Update Current Turn Chip Appearance
                    const currentTurnChip = document.getElementById('currentTurnChip');
                    if (currentTurnChip) {
                        currentTurnChip.textContent = `Current Turn: ${currentPlayer}`;
                    }
                }
            }, error => {
                console.error("Error listening to currentPlayer updates:", error);
            });

            // Listen for changes to Continue Flags
            ref.child('continueFlags').on('value', snapshot => {
                const flags = snapshot.val();
                if (flags) {
                    console.log("Continue flags updated:", flags);
                    checkContinueFlags(flags);
                }
            }, error => {
                console.error("Error listening to continue flags:", error);
            });

            // Listen for changes to Return to Menu Flags
            ref.child('returnToMenuFlags').on('value', snapshot => {
                const flags = snapshot.val();
                if (flags) {
                    console.log("Return to Menu flags updated:", flags);
                    checkReturnToMenuFlags(flags);
                }
            }, error => {
                console.error("Error listening to Return to Menu flags:", error);
            });

            // Listen for changes to Player X's score
            ref.child('players/X/score').on('value', snapshot => {
                const scoreX = snapshot.val();
                scoreXElement.textContent = scoreX !== null ? scoreX : 0;
                console.log(`Player X score updated to: ${scoreX}`);
            }, error => {
                console.error("Error listening to Player X score updates:", error);
            });

            // Listen for changes to Player O's score
            ref.child('players/O/score').on('value', snapshot => {
                const scoreO = snapshot.val();
                scoreOElement.textContent = scoreO !== null ? scoreO : 0;
                console.log(`Player O score updated to: ${scoreO}`);
            }, error => {
                console.error("Error listening to Player O score updates:", error);
            });

            // Listen for changes to Player X's online status
            // Listen for changes to Player X's online status
            ref.child('players/X/online').on('value', snapshot => {
                const isOnline = snapshot.val();
                playerXElement.classList.toggle('online', isOnline);
                console.log(`Player X online status: ${isOnline}`);
                // If Player X went offline while in game, notify Player O
                if (!isOnline && playerSymbol === 'O') {
                    otherPlayerLeftMessage.textContent = 'Player X has left the game.';
                    otherPlayerLeftMessage.style.display = 'block';
                } else {
                    otherPlayerLeftMessage.style.display = 'none';
                }
            }, error => {
                console.error("Error listening to Player X online status:", error);
            });

            // Listen for changes to Player O's online status
            ref.child('players/O/online').on('value', snapshot => {
                const isOnline = snapshot.val();
                playerOElement.classList.toggle('online', isOnline);
                console.log(`Player O online status: ${isOnline}`);
                // If Player O went offline while in game, notify Player X
                if (!isOnline && playerSymbol === 'X') {
                    otherPlayerLeftMessage.textContent = 'Player O has left the game.';
                    otherPlayerLeftMessage.style.display = 'block';
                } else {
                    otherPlayerLeftMessage.style.display = 'none';
                }
            }, error => {
                console.error("Error listening to Player O online status:", error);
            });
        }

        // Function to Check Continue Flags
        function checkContinueFlags(flags) {
            if (playerSymbol === 'X') {
                if (flags.O && flags.X) {
                    resetGame();
                }
            } else if (playerSymbol === 'O') {
                if (flags.X && flags.O) {
                    resetGame();
                }
            }
        }

        // Function to Check Return to Menu Flags
        function checkReturnToMenuFlags(flags) {
            if (flags.X || flags.O) {
                returnToMenuBothPlayers();
            }
        }

        // Function to Start the Game in Online Multiplayer
        function startGame() {
            console.log("Starting the online multiplayer game...");
            // Hide game menu and show game container
            gameMenu.style.display = 'none';
            container.style.display = 'flex';

            // Attach event listeners to cells
            cells.forEach((cell, index) => {
                cell.addEventListener('click', () => handleCellClick(index));
            });

            console.log("Game listeners attached to cells.");
        }

        // Function to Handle Cell Clicks in Online Multiplayer
        function handleCellClick(index) {
            // Prevent moves if the game isn't in progress
            gameRef.child('status').once('value').then(snapshot => {
                const status = snapshot.val();
                if (status !== 'in-progress') {
                    alert('Game is not in progress yet!');
                    console.log("Move attempted while game is not in progress.");
                    return;
                }

                if (currentPlayer !== playerSymbol) {
                    alert('Not your turn!');
                    console.log("Move attempted out of turn.");
                    return;
                }

                const cell = cells[index];
                if (cell.textContent && cell.textContent.trim() !== '') {
                    alert('Cell already taken!');
                    console.log("Move attempted on an occupied cell.");
                    return;
                }

                console.log(`Player ${playerSymbol} clicked cell ${index}`);
                // Update cell locally
                cell.textContent = playerSymbol;
                cell.classList.add('show-letter', playerSymbol);
                cell.classList.add('flipped');

                // Disable the cell to prevent further clicks
                cell.style.pointerEvents = 'none';

                // Update game state in Firebase
                updateGameBoard(index, playerSymbol);
            }).catch(error => {
                console.error("Error checking game status:", error);
            });
        }

        // Function to Update the Game Board in Online Multiplayer
        function updateGameBoard(index, symbol) {
            console.log(`Attempting to update board at index ${index} with symbol ${symbol}`);
            const boardRef = gameRef.child('board');
            boardRef.once('value').then(snapshot => {
                let board = snapshot.val();
                console.log("!!" + board);
                if (!board) {
                    // Initialize board as an object with keys "0" to "8"
                    board = {
                        0: null,
                        1: null,
                        2: null,
                        3: null,
                        4: null,
                        5: null,
                        6: null,
                        7: null,
                        8: null
                    };
                } else {
                    // Ensure all keys from 0 to 8 are present and set to null if missing
                    for (let i = 0; i < 9; i++) {
                        if (!board.hasOwnProperty(i)) {
                            board[i] = null;
                        }
                    }
                }

                // Check if the cell is already taken by 'X' or 'O'
                if (board[index] === 'X' || board[index] === 'O') {
                    console.log(`Cell ${index} is already taken.`);
                    return; // Cell already taken
                }

                // Assign the symbol to the board
                board[index] = symbol;

                // Update the board in Firebase
                boardRef.set(board)
                    .then(() => {
                        // Update the currentPlayer in Firebase
                        return gameRef.child('currentPlayer').set(symbol === 'X' ? 'O' : 'X');
                    })
                    .then(() => {
                        console.log(`Board updated at index ${index} with symbol ${symbol}. Next player: ${symbol === 'X' ? 'O' : 'X'}`);

                        // Check for win or draw
                        const boardArray = Object.keys(board).sort((a, b) => a - b).map(key => board[key]);
                        const winner = determineWinner(boardArray);
                        if (winner) {
                            return gameRef.child('status').set('finished').then(() => {
                                console.log(`Player ${winner} has won the game.`);
                                // Update scores
                                return gameRef.child(`players/${winner}/score`).transaction(score => (score || 0) + 1);
                            }).then(() => {
                                console.log(`Player ${winner}'s score incremented.`);
                            });
                        } else if (isBoardFull(boardArray)) {
                            return gameRef.child('status').set('finished').then(() => {
                                console.log("Game ended in a draw.");
                            });
                        }
                    })
                    .catch(error => {
                        console.error("Error updating board and currentPlayer:", error);
                    });
            }).catch(error => {
                console.error("Error fetching board data:", error);
            });
        }

        // Function to Update the Board UI in Online Multiplayer
        function updateBoard(board) {
            console.log("Received board update:", board, board.length);

            // Convert board object to array if it's not an array
            if (!Array.isArray(board)) {
                console.warn("Board data is not an array. Converting to array.");
                const tempBoard = [];
                for (let i = 0; i < 9; i++) {
                    tempBoard[i] = board.hasOwnProperty(i) ? board[i] : null;
                }
                board = tempBoard;
            }

            console.log("Post Change", board);

            // Ensure board has 9 elements
            if (board.length < 9) {
                console.warn("Board data is incomplete. Filling missing cells with null.");
                for (let i = 0; i < 9; i++) {
                    if (typeof board[i] === 'undefined') {
                        board[i] = null;
                    }
                }
            }

            cells.forEach((cell, index) => {
                const symbol = board[index];
                cell.textContent = symbol ? symbol : '';
                if (symbol) {
                    cell.classList.add('show-letter', symbol);
                    cell.classList.add('flipped');
                    cell.style.pointerEvents = 'none'; // Disable further clicks
                    console.log(`Cell ${index} updated to ${symbol}`);
                } else {
                    cell.classList.remove('show-letter', 'X', 'O', 'flipped');
                    cell.style.pointerEvents = 'auto'; // Enable clicks
                    console.log(`Cell ${index} cleared and enabled for clicking.`);
                }
            });

            // Print the board values for debugging
            console.log("Current board state:");
            for (let i = 0; i < board.length; i += 3) {
                console.log(board.slice(i, i + 3).join(' | '));
            }
        }

        // Function to Determine the Winner
        function determineWinner(board) {
            const WINNING_COMBINATIONS = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6]
            ];

            for (let combination of WINNING_COMBINATIONS) {
                const [a, b, c] = combination;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return board[a];
                }
            }
            return null;
        }

        // Function to Check if the Board is Full
        function isBoardFull(boardArray) {
            console.log("Checking if board is full:", boardArray);
            console.log(boardArray.length);
            for (let i = 0; i < boardArray.length; i++) {
                const cell = boardArray[i];
                if (cell !== 'X' && cell !== 'O') {
                    console.log(`Cell ${i} is not filled. Current value: ${cell}`);
                    return false;
                }
            }
            console.log("All cells are filled.");
            return true;
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Display the Game Over Modal in Online Multiplayer
        function showGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Handle Continue Button Click in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Continue Game in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';

                // Hide Other Player Left Message
                otherPlayerLeftMessage.style.display = 'none';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenu() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Continue Game in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenu() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        function resetBoardUI() {
            cells.forEach(cell => {
                cell.textContent = '';
                cell.classList.remove('show-letter', 'X', 'O', 'flipped');
                cell.style.pointerEvents = 'auto';
            });

            cellsPP.forEach(cell => {
                cell.textContent = '';
                cell.classList.remove('show-letter', 'X', 'O', 'flipped');
                cell.style.pointerEvents = 'auto';
            });
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Continue Game in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenu() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Continue Game in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenu() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Continue Game in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenu() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Continue Game in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenu() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Continue Game in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenu() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to Continue Game in Online Multiplayer
        function handleContinueButton() {
            console.log("Player clicked Continue.");
            // Disable the Continue button to prevent multiple clicks
            continueButton.disabled = true;
            continueButton.classList.add('continue-clicked');
            continueButton.textContent = '1/2 Votes';

            // Set the continue flag for the player
            gameRef.child('continueFlags').child(playerSymbol).set(true).then(() => {
                // Check if both players have clicked Continue
                gameRef.child('continueFlags').once('value').then(snapshot => {
                    const flags = snapshot.val();
                    if (flags && flags.X && flags.O) {
                        resetGame();
                    }
                });
            }).catch(error => {
                console.error("Error setting continue flag:", error);
            });
        }

        // Function to Reset the Game in Online Multiplayer
        function resetGame() {
            console.log("Resetting the game for a new round...");
            // Reset the board and flags in Firebase
            gameRef.update({
                board: {
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                },
                currentPlayer: 'X', // Optionally, alternate who starts
                status: 'in-progress',
                continueFlags: {
                    X: false,
                    O: false
                },
                returnToMenuFlags: {
                    X: false,
                    O: false
                }
            }).then(() => {
                console.log("Game reset successfully.");

                // Reset the UI board
                updateBoard({
                    0: null,
                    1: null,
                    2: null,
                    3: null,
                    4: null,
                    5: null,
                    6: null,
                    7: null,
                    8: null
                });

                // Hide the Game Over Modal
                gameOverModal.style.display = "none";

                // Re-enable all cells for clicking
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                    cell.classList.remove('flipped', 'show-letter', 'X', 'O');
                    cell.textContent = '';
                });

                // Reset Continue Button
                continueButton.disabled = false;
                continueButton.classList.remove('continue-clicked');
                continueButton.textContent = 'Continue';

                // Reset Current Turn Chip
                const currentTurnChip = document.getElementById('currentTurnChip');
                if (currentTurnChip) {
                    currentTurnChip.textContent = `Current Turn: X`;
                }

                // Reset currentPlayer indicator
                currentPlayer = 'X';
                turnIndicator.textContent = 'X';
            }).catch(error => {
                console.error("Error resetting the game:", error);
            });
        }

        // Function to Return to Menu in Online Multiplayer
        function returnToMenu() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Return to Menu for Both Players
        function returnToMenuBothPlayers() {
            console.log("Reloading the website...");
            location.reload();
        }

        // Function to Detach Firebase Listeners
        function detachListeners(ref) {
            if (!ref) return;

            ref.child('board').off();
            ref.child('status').off();
            ref.child('currentPlayer').off();
            ref.child('players/X/score').off();
            ref.child('players/O/score').off();
            ref.child('players/X/online').off();
            ref.child('players/O/online').off();
            ref.child('continueFlags').off();
            ref.child('returnToMenuFlags').off();

            console.log("All Firebase listeners detached.");
        }

        // Function to Set Player Role Display in Online Multiplayer
        function setPlayerRoleDisplay() {
            if (playerSymbol) {
                playerRoleDisplay.textContent = playerSymbol;
                const playerRoleChip = document.getElementById('playerRoleChip');
                if (playerRoleChip) {
                    playerRoleChip.classList.add('player-role');
                }
            }
        }

        // Function to Handle Game Over in Online Multiplayer
        function handleOnlineGameOver(winner) {
            if (winner) {
                gameOverMessage.textContent = `Player ${winner} Wins!`;
                winnerSymbolElement.textContent = winner;
                triggerConfetti();
                console.log(`Game Over: Player ${winner} Wins!`);
            } else {
                gameOverMessage.textContent = "It's a Draw!";
                winnerSymbolElement.textContent = '';
                console.log("Game Over: It's a Draw!");
            }
            gameOverModal.style.display = "block";
        }

        // Function to Trigger Confetti Animation
        function triggerConfetti() {
            confetti({
                particleCount: 200,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Handle Player Disconnects
        window.onbeforeunload = function () {
            if (gameRef && playerSymbol === 'X') {
                gameRef.child('players/X/online').set(false);
            }
            if (gameRef && playerSymbol === 'O') {
                gameRef.child('players/O/online').set(false);
            }
        }
    </script>
</body>

</html>
